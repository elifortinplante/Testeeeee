<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flashcards App</title>
<style>
  body {margin:0;font-family:Arial,sans-serif;background:linear-gradient(135deg,#a18cd1,#fbc2eb,#8fd3f4);min-height:100vh;display:flex;justify-content:center;align-items:center;}
  .container {width:90%;max-width:800px;background:white;border-radius:20px;padding:20px;box-shadow:0 8px 20px rgba(0,0,0,0.2);}
  h1,h2{text-align:center;color:#333;}
  .hidden{display:none;}
  .set{display:flex;align-items:center;background:#f3f3f3;border-radius:15px;padding:10px;margin:10px 0;cursor:pointer;transition:0.3s;}
  .set:hover{background:#e8e8e8;}
  .set img{width:60px;height:60px;border-radius:12px;object-fit:cover;margin-right:15px;}
  .set-buttons{margin-left:auto;display:flex;gap:5px;}
  .card-container{perspective:1000px;margin:20px 0;position:relative;}
  .card{width:100%;height:350px;position:relative;transform-style:preserve-3d;transition:transform 0.6s;cursor:pointer;}
  .card.flipped{transform:rotateY(180deg);}
  .card-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:20px;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;box-sizing:border-box;font-weight:bold;text-align:center;color:#333;overflow:hidden;}
  .card-front{background:#fff;}
  .card-back{background:#f0f0f0;transform:rotateY(180deg);}
  .card-face img{width:100%;max-height:250px;margin-bottom:15px;object-fit:contain;}
  .answer-buttons{display:flex;justify-content:space-between;margin-top:20px;}
  .answer-buttons button{flex:1;margin:0 5px;padding:10px;font-size:18px;border:none;border-radius:12px;cursor:pointer;transition:0.3s;}
  .correct{background:#a0e7a0;}
  .incorrect{background:#f28b82;}
  .correct:hover{background:#77d677;}
  .incorrect:hover{background:#e06666;}
  #score-screen{text-align:center;}
  #score-screen button{margin:10px;padding:12px 20px;font-size:16px;border:none;border-radius:12px;cursor:pointer;background:#a18cd1;color:white;transition:0.3s;}
  #score-screen button:hover{background:#875fb3;}
  .card-editor{margin-bottom:10px;}
  .card-editor input{display:block;width:95%;margin-bottom:5px;}
  .drag-resize {position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:move;border:1px dashed #aaa;padding:5px;border-radius:10px;background:rgba(255,255,255,0.8);}
</style>
</head>
<body>
<div class="container">

  <!-- Accueil -->
  <div id="home-screen">
    <h1>Mes Sets</h1>
    <button onclick="showSetEditor()">â• Nouveau set</button>
    <button onclick="document.getElementById('import-file').click()">ğŸ“¥ Importer un set</button>
    <button onclick="exportAllSets()">ğŸ’¾ Exporter tous les sets</button>
    <input type="file" id="import-file" class="hidden" onchange="importSet(event)">
    <div id="sets-list"></div>
  </div>

  <!-- Ã‰diteur -->
  <div id="editor-screen" class="hidden">
    <h2>CrÃ©er / Modifier un Set</h2>
    <input type="text" id="set-title" placeholder="Titre du set"><br><br>
    <input type="text" id="set-subject" placeholder="MatiÃ¨re"><br><br>
    <input type="text" id="set-image" placeholder="URL image pour lâ€™accueil">
    <input type="file" accept="image/*" id="set-image-file" style="display:none">
    <button onclick="document.getElementById('set-image-file').click()">ğŸ“¸ Galerie couverture</button><br><br>
    <div id="cards-editor"></div>
    <button onclick="addCardEditor()">â• Ajouter une carte</button><br><br>
    <button onclick="toggleTestMode()">ğŸ§ª Mode Test</button>
    <button onclick="saveSet()">ğŸ’¾ Sauvegarder</button>
    <button onclick="goHome()">ğŸ  Accueil</button>
    <div id="test-preview" class="hidden" style="position:relative;width:100%;height:350px;margin-top:20px;border:1px solid #ccc;"></div>
  </div>

  <!-- Jeu -->
  <div id="game-screen" class="hidden">
    <h2 id="game-title"></h2>
    <div class="card-container">
      <div class="card" onclick="flipCard()">
        <div class="card-face card-front">
          <img id="card-image-front" alt="">
          <div id="card-question"></div>
        </div>
        <div class="card-face card-back">
          <img id="card-image-back" alt="">
          <div id="card-answer"></div>
        </div>
      </div>
    </div>
    <div class="answer-buttons">
      <button class="incorrect" onclick="markAnswer(false)">Mauvais</button>
      <button class="correct" onclick="markAnswer(true)">Bon</button>
    </div>
  </div>

  <!-- Score -->
  <div id="score-screen" class="hidden">
    <h2>RÃ©sultat</h2>
    <p id="final-score"></p>
    <button onclick="restartAll()">ğŸ”„ Recommencer tout</button>
    <button onclick="restartErrors()">âŒ Rejouer erreurs</button>
    <button onclick="goHome()">ğŸ  Accueil</button>
  </div>
</div>

<script>
let sets = JSON.parse(localStorage.getItem("sets"))||[];
let currentSet=null,currentCards=[],currentIndex=0,errors=[];
let testMode=false,currentTestCard=0;

// Sauvegarde
function saveSets(){localStorage.setItem("sets",JSON.stringify(sets));}

// Accueil
function goHome(){
  document.querySelectorAll(".container > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById("home-screen").classList.remove("hidden");
  displaySets();
}

// Ã‰diteur
function showSetEditor(setIndex=null){
  document.querySelectorAll(".container > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById("editor-screen").classList.remove("hidden");
  document.getElementById("cards-editor").innerHTML="";
  document.getElementById("test-preview").classList.add("hidden");
  testMode=false;

  document.getElementById("set-image-file").onchange=(e)=>{
    const file=e.target.files[0];
    if(!file)return;
    const reader=new FileReader();
    reader.onload=(ev)=>{document.getElementById("set-image").value=ev.target.result;};
    reader.readAsDataURL(file);
  };

  if(setIndex!==null){
    currentSet=sets[setIndex];
    document.getElementById("set-title").value=currentSet.title;
    document.getElementById("set-subject").value=currentSet.subject;
    document.getElementById("set-image").value=currentSet.image;
    currentSet.cards.forEach(c=>addCardEditor(c.question,c.answer,c.image));
  }else{currentSet=null;}
}

function addCardEditor(q='',a='',img=''){
  const div=document.createElement("div");
  div.className="card-editor";
  div.innerHTML=`
    <input type="text" placeholder="Question" value="${q}">
    <input type="text" placeholder="RÃ©ponse" value="${a}">
    <input type="text" placeholder="URL image ou vide" value="${img}">
    <input type="file" accept="image/*" class="img-upload" style="display:none">
    <button class="btn-photo">ğŸ“¸ Galerie</button>
    <button class="btn-del-card">ğŸ—‘ï¸ Supprimer cette carte</button><hr>`;
  document.getElementById("cards-editor").appendChild(div);

  const imgInput=div.querySelector(".img-upload");
  const urlInput=div.children[2];

  div.querySelector(".btn-photo").onclick=()=>imgInput.click();
  imgInput.onchange=(e)=>{
    const file=e.target.files[0]; if(!file)return;
    const reader=new FileReader();
    reader.onload=(ev)=>{urlInput.value=ev.target.result;};
    reader.readAsDataURL(file);
  };
  div.querySelector(".btn-del-card").onclick=()=>div.remove();
}

// Sauvegarde set
function saveSet(){
  const title=document.getElementById("set-title").value;
  const subject=document.getElementById("set-subject").value;
  const image=document.getElementById("set-image").value;
  const cards=[];
  document.querySelectorAll("#cards-editor>.card-editor").forEach(div=>{
    const q=div.children[0].value;
    const a=div.children[1].value;
    const img=div.children[2].value;
    if(q&&a)cards.push({question:q,answer:a,image:img});
  });
  if(currentSet){currentSet.title=title;currentSet.subject=subject;currentSet.image=image;currentSet.cards=cards;}
  else{sets.push({title,subject,image,cards});}
  saveSets();currentSet=null;goHome();
}

// Affichage sets
function displaySets(){
  const list=document.getElementById("sets-list");
  list.innerHTML="";
  sets.forEach((s,i)=>{
    const div=document.createElement("div");
    div.className="set";
    div.innerHTML=`<img src="${s.image||'https://via.placeholder.com/60'}">
                   <div><strong>${s.title}</strong><br><small>${s.subject}</small></div>`;
    div.onclick=()=>startGame(i);

    const btnDiv=document.createElement("div");btnDiv.className="set-buttons";
    const editBtn=document.createElement("button");editBtn.textContent="âœï¸ Modifier";editBtn.onclick=e=>{e.stopPropagation();showSetEditor(i);};
    const delBtn=document.createElement("button");delBtn.textContent="ğŸ—‘ï¸ Supprimer";delBtn.onclick=e=>{e.stopPropagation();sets.splice(i,1);saveSets();displaySets();};
    const shareBtn=document.createElement("button");shareBtn.textContent="ğŸ“¤ Partager";shareBtn.onclick=async e=>{
      e.stopPropagation();
      const jsonStr=JSON.stringify(sets[i],null,2);
      const blob=new Blob([jsonStr],{type:"application/json"});
      const file=new File([blob],`${sets[i].title.replace(/[^a-z0-9]/gi,"_")||"set"}.json`,{type:"application/json"});
      if(navigator.canShare&&navigator.canShare({files:[file]})){
        try{await navigator.share({files:[file],title:sets[i].title,text:"Voici mon set de flashcards !"});alert("âœ… Set partagÃ© ou enregistrÃ© !");return;}catch(err){console.log(err);}
      }
      const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=`${sets[i].title.replace(/[^a-z0-9]/gi,"_")||"set"}.json`;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);alert("âœ… Fichier tÃ©lÃ©chargÃ© !");
    };
    btnDiv.appendChild(editBtn);btnDiv.appendChild(delBtn);btnDiv.appendChild(shareBtn);
    div.appendChild(btnDiv);list.appendChild(div);
  });
}

// Mode Test
function toggleTestMode(){
  const preview=document.getElementById("test-preview");
  if(testMode){preview.classList.add("hidden");testMode=false;return;}
  if(document.querySelectorAll("#cards-editor>.card-editor").length===0){alert("Ajouter au moins une carte pour tester !");return;}
  testMode=true;
  preview.innerHTML="";
  preview.classList.remove("hidden");
  currentTestCard=0;
  showTestCard();
}

function showTestCard(){
  const preview=document.getElementById("test-preview");
  preview.innerHTML="";
  const editor=document.querySelectorAll("#cards-editor>.card-editor")[currentTestCard];
  const q=editor.children[0].value;
  const a=editor.children[1].value;
  const imgSrc=editor.children[2].value;

  const cardDiv=document.createElement("div");
  cardDiv.style.position="relative";cardDiv.style.width="100%";cardDiv.style.height="100%";cardDiv.style.border="1px solid #aaa";cardDiv.style.borderRadius="15px";cardDiv.style.background="#fff";cardDiv.style.display="flex";cardDiv.style.flexDirection="column";cardDiv.style.alignItems="center";cardDiv.style.justifyContent="center";

  const img=document.createElement("img");img.src=imgSrc;img.style.maxHeight="250px";img.style.objectFit="contain";img.className="draggable";
  const question=document.createElement("div");question.textContent=q;question.style.fontSize="28px";question.style.textAlign="center";question.style.cursor="move";question.className="draggable";
  const answer=document.createElement("div");answer.textContent=a;answer.style.fontSize="24px";answer.style.textAlign="center";answer.style.cursor="move";answer.className="draggable";

  cardDiv.appendChild(img);cardDiv.appendChild(question);cardDiv.appendChild(answer);
  preview.appendChild(cardDiv);

  // Drag simple
  const draggables=[img,question,answer];
  draggables.forEach(el=>{
    el.onmousedown=function(e){
      e.preventDefault();
      let shiftX=e.clientX-el.getBoundingClientRect().left;
      let shiftY=e.clientY-el.getBoundingClientRect().top;
      function moveAt(pageX,pageY){el.style.position="absolute";el.style.zIndex=1000;el.style.left=pageX-shiftX-preview.getBoundingClientRect().left+"px";el.style.top=pageY-shiftY-preview.getBoundingClientRect().top+"px";}
      function onMouseMove(ev){moveAt(ev.pageX,ev.pageY);}
      document.addEventListener("mousemove",onMouseMove);
      document.onmouseup=function(){document.removeEventListener("mousemove",onMouseMove);document.onmouseup=null;}
    };
    el.ondragstart=function(){return false;};
  });

  // Simple navigation carte
  if(document.querySelectorAll("#cards-editor>.card-editor").length>1){
    const nextBtn=document.createElement("button");nextBtn.textContent="â¡ï¸";nextBtn.style.position="absolute";nextBtn.style.bottom="5px";nextBtn.style.right="5px";
    nextBtn.onclick=()=>{currentTestCard=(currentTestCard+1)%document.querySelectorAll("#cards-editor>.card-editor").length;showTestCard();}
    preview.appendChild(nextBtn);
  }
}

// Ici reste le code du jeu et score comme avant...

</script>
</body>
</html>
