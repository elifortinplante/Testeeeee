<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flashcards App</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#a18cd1,#fbc2eb,#8fd3f4);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container{
  width:90%;
  max-width:800px;
  background:white;
  border-radius:20px;
  padding:20px;
  box-shadow:0 8px 20px rgba(0,0,0,0.2);
}
.hidden{display:none}
h1,h2{text-align:center}

.set{
  display:flex;
  align-items:center;
  background:#f3f3f3;
  border-radius:15px;
  padding:10px;
  margin:10px 0;
  cursor:pointer;
}
.set img{
  width:60px;height:60px;
  border-radius:12px;
  object-fit:cover;
  margin-right:15px;
}
.set-buttons{margin-left:auto;display:flex;gap:5px}

.card-container{perspective:1000px;margin:20px 0}
.card{
  width:100%;height:350px;
  position:relative;
  transform-style:preserve-3d;
  transition:transform .6s;
  cursor:pointer;
}
.card.flipped{transform:rotateY(180deg)}
.card-face{
  position:absolute;width:100%;height:100%;
  backface-visibility:hidden;
  border-radius:20px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  padding:20px;
  font-weight:bold;
  text-align:center;
}
.card-front{background:#fff}
.card-back{background:#f0f0f0;transform:rotateY(180deg)}
.card-face img{max-height:250px;width:100%;object-fit:contain}

.answer-buttons{display:flex;gap:10px}
.answer-buttons button{
  flex:1;
  padding:10px;
  font-size:18px;
  border:none;
  border-radius:12px;
}

.correct{background:#a0e7a0}
.incorrect{background:#f28b82}

.card-editor input{display:block;width:95%;margin-bottom:5px}

.color-box,.order-box{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:8px;
  background:#eee;
  padding:10px;
  border-radius:12px;
  margin-bottom:5px;
}
.color-dot{
  width:28px;height:28px;
  border-radius:50%;
  cursor:pointer;
}
.order-num{
  background:white;
  border-radius:8px;
  text-align:center;
  padding:5px;
  cursor:pointer;
  font-weight:bold;
}
</style>
</head>

<body>
<div class="container">

<!-- ACCUEIL -->
<div id="home-screen">
<h1>Mes Sets</h1>
<button onclick="showSetEditor()">‚ûï Nouveau set</button>
<div id="sets-list"></div>
</div>

<!-- EDITEUR -->
<div id="editor-screen" class="hidden">
<h2>Cr√©er / Modifier</h2>
<input id="set-title" placeholder="Titre"><br><br>
<input id="set-subject" placeholder="Mati√®re"><br><br>
<div id="cards-editor"></div>
<button onclick="addCardEditor()">‚ûï Carte</button>
<button onclick="saveSet()">üíæ Sauvegarder</button>
<button onclick="goHome()">üè† Accueil</button>
</div>

<!-- JEU -->
<div id="game-screen" class="hidden">
<h2 id="game-title"></h2>
<div class="card-container">
<div class="card" onclick="flipCard()">
<div class="card-face card-front">
<img id="card-image-front">
<div id="card-question"></div>
</div>
<div class="card-face card-back">
<img id="card-image-back">
<div id="card-answer"></div>
</div>
</div>
</div>
<div class="answer-buttons">
<button class="incorrect" onclick="markAnswer(false)">Mauvais</button>
<button class="correct" onclick="markAnswer(true)">Bon</button>
</div>
</div>

<!-- SCORE -->
<div id="score-screen" class="hidden">
<h2>R√©sultat</h2>
<p id="final-score"></p>
<button onclick="restartAll()">üîÑ Recommencer</button>
<button onclick="restartErrors()">‚ùå Erreurs</button>
<button onclick="goHome()">üè† Accueil</button>
</div>

</div>

<script>
let sets=JSON.parse(localStorage.getItem("sets"))||[];
let currentSet,currentCards=[],currentIndex=0,errors=[];

function saveSets(){localStorage.setItem("sets",JSON.stringify(sets))}
function goHome(){
document.querySelectorAll(".container>div").forEach(d=>d.classList.add("hidden"));
home-screen.classList.remove("hidden");
displaySets();
}

function addCardEditor(q="",a="",img="",color=null,order=null){
const d=document.createElement("div");
d.innerHTML=`
<input placeholder="Question" value="${q}">
<input placeholder="R√©ponse" value="${a}">
<input placeholder="Image" value="${img}">
<button class="btn-color">üé® Couleur</button>
<button onclick="this.parentElement.remove()">üóëÔ∏è Supprimer</button>
`;
d.dataset.color=color;
d.dataset.order=order;
d.querySelector(".btn-color").onclick=()=>showColorPicker(d);
cards-editor.appendChild(d);
}

function showColorPicker(card){
const box=document.createElement("div");
box.className="color-box";
["red","blue","green","orange","purple","black","gray"].forEach(c=>{
const dot=document.createElement("div");
dot.className="color-dot";
dot.style.background=c;
dot.onclick=()=>{
card.dataset.color=c;
box.remove();
showOrderPicker(card);
};
box.appendChild(dot);
});
card.appendChild(box);
}

function showOrderPicker(card){
const box=document.createElement("div");
box.className="order-box";
for(let i=1;i<=10;i++){
const n=document.createElement("div");
n.className="order-num";
n.textContent=i;
n.onclick=()=>{
card.dataset.order=i;
box.remove();
};
box.appendChild(n);
}
card.appendChild(box);
}

function saveSet(){
const cards=[];
document.querySelectorAll("#cards-editor>div").forEach(c=>{
const inputs=c.querySelectorAll("input");
if(inputs[0].value&&inputs[1].value){
cards.push({
question:inputs[0].value,
answer:inputs[1].value,
image:inputs[2].value,
color:c.dataset.color||null,
order:c.dataset.order?Number(c.dataset.order):null
});
}
});
sets.push({title:set-title.value,subject:set-subject.value,cards});
saveSets();goHome();
}

function displaySets(){
sets-list.innerHTML="";
sets.forEach((s,i)=>{
const d=document.createElement("div");
d.className="set";
d.textContent=s.title;
d.onclick=()=>startGame(i);
sets-list.appendChild(d);
});
}

function startGame(i){
currentSet=sets[i];
let free=[],groups={};

currentSet.cards.forEach(c=>{
if(!c.color) free.push(c);
else{
if(!groups[c.color]) groups[c.color]=[];
groups[c.color].push(c);
}
});

Object.values(groups).forEach(g=>g.sort((a,b)=>(a.order||0)-(b.order||0)));
const groupArray=Object.values(groups);
shuffle(groupArray);shuffle(free);

currentCards=[];
groupArray.forEach(g=>currentCards.push(...g));
currentCards.push(...free);

currentIndex=0;errors=[];
game-screen.classList.remove("hidden");
home-screen.classList.add("hidden");
showCard();
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}

function showCard(){
const c=currentCards[currentIndex];
card-question.textContent=c.question;
card-answer.textContent=c.answer;
card-image-front.style.display=c.image?"block":"none";
card-image-back.style.display=c.image?"block":"none";
card-image-front.src=c.image||"";
card-image-back.src=c.image||"";
document.querySelector(".card").classList.remove("flipped");
}

function flipCard(){document.querySelector(".card").classList.toggle("flipped")}
function markAnswer(ok){
if(!ok)errors.push(currentCards[currentIndex]);
currentIndex++;
currentIndex<currentCards.length?showCard():endGame();
}
function endGame(){
game-screen.classList.add("hidden");
score-screen.classList.remove("hidden");
final-score.textContent=`Score ${currentCards.length-errors.length}/${currentCards.length}`;
}
function restartAll(){startGame(sets.indexOf(currentSet))}
function restartErrors(){
if(!errors.length)return alert("Aucune erreur");
currentCards=[...errors];errors=[];currentIndex=0;
score-screen.classList.add("hidden");
game-screen.classList.remove("hidden");
showCard();
}

goHome();
</script>
</body>
</html>
