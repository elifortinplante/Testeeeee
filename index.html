<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flashcards App Final V2</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:linear-gradient(135deg,#a18cd1,#fbc2eb,#8fd3f4); min-height:100vh; display:flex; justify-content:center; align-items:center; }
.container { width:90%; max-width:800px; background:white; border-radius:20px; padding:20px; box-shadow:0 8px 20px rgba(0,0,0,0.2);}
h1,h2{text-align:center;color:#333;}
.hidden{display:none;}
.set { display:flex; align-items:center; background:#f3f3f3; border-radius:15px; padding:10px; margin:10px 0; cursor:pointer; transition:0.3s; }
.set:hover{background:#e8e8e8;}
.set img{width:60px;height:60px;border-radius:12px;object-fit:cover;margin-right:15px;}
.set-buttons { margin-left:auto; display:flex; gap:5px; }
.card-container{ perspective:1000px; margin:20px 0; }
.card { width:100%; height:350px; position:relative; transform-style:preserve-3d; transition:transform 0.6s; cursor:pointer; }
.card.flipped{transform:rotateY(180deg);}
.card-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:20px; display:flex; flex-direction:column; justify-content:flex-start; align-items:flex-start; padding:20px; box-sizing:border-box; font-weight:bold; text-align:left; color:#333; overflow:hidden;}
.card-front{background:#fff;}
.card-back{background:#f0f0f0; transform:rotateY(180deg);}
.card-face img{object-fit:contain; position:absolute;}
.answer-buttons{display:flex; justify-content:space-between; margin-top:20px;}
.answer-buttons button{flex:1;margin:0 5px;padding:10px;font-size:18px;border:none;border-radius:12px;cursor:pointer; transition:0.3s;}
.correct{background:#a0e7a0;}
.incorrect{background:#f28b82;}
.correct:hover{background:#77d677;}
.incorrect:hover{background:#e06666;}
#score-screen{text-align:center;}
#score-screen button{margin:10px;padding:12px 20px;font-size:16px;border:none;border-radius:12px; cursor:pointer;background:#a18cd1;color:white; transition:0.3s;}
#score-screen button:hover{background:#875fb3;}
.card-editor{margin-bottom:10px;}
.card-editor input{display:block;width:95%;margin-bottom:5px;}

/* Pr√©visualisation */
.draggable { touch-action:none; cursor:grab; position:absolute; }
.slider-container { position:relative; width:30px; height:200px; background:#eee; border-radius:15px; user-select:none; margin:0 5px; }
.slider-bille { position:absolute; bottom:0; left:0; width:100%; height:20px; border-radius:50%; background:#888; cursor:pointer; }
.preview-container { display:flex; gap:20px; }
.card-container-preview { position:relative; flex:1; height:400px; border:1px solid #ccc; border-radius:20px; overflow:hidden; }
.controls { display:flex; flex-direction:column; justify-content:flex-start; gap:15px; }
.controls-row { display:flex; gap:10px; justify-content:center; }
.controls div{display:flex; flex-direction:column; align-items:center;}
.controls label{display:block;text-align:center;margin-bottom:5px;}
</style>
</head>
<body>
<div class="container">

<!-- Accueil -->
<div id="home-screen">
<h1>Mes Sets</h1>
<button onclick="showSetEditor()">‚ûï Nouveau set</button>
<button onclick="document.getElementById('import-file').click()">üì• Importer un set</button>
<button onclick="exportAllSets()">üíæ Exporter tous les sets</button>
<input type="file" id="import-file" class="hidden" onchange="importSet(event)">
<div id="sets-list"></div>
</div>

<!-- √âditeur -->
<div id="editor-screen" class="hidden">
<h2>Cr√©er / Modifier un Set</h2>
<input type="text" id="set-title" placeholder="Titre du set"><br><br>
<input type="text" id="set-subject" placeholder="Mati√®re"><br><br>
<input type="text" id="set-image" placeholder="URL image pour l‚Äôaccueil">
<input type="file" accept="image/*" id="set-image-file" style="display:none">
<button onclick="document.getElementById('set-image-file').click()">üì∏ Galerie couverture</button><br><br>
<div id="cards-editor"></div>
<button onclick="addCardEditor()">‚ûï Ajouter une carte</button><br><br>
<button onclick="saveSet()">üíæ Sauvegarder</button>
<button onclick="goHome()">üè† Accueil</button>
<button onclick="showPreviewForCurrentSet()">üëÅÔ∏è Pr√©visualisation</button>
</div>

<!-- Pr√©visualisation -->
<div id="preview-screen" class="hidden">
<h2>Pr√©visualisation</h2>
<div class="preview-container">
<div class="card-container-preview">
<div id="preview-text" class="draggable">Texte</div>
<img id="preview-image" class="draggable"/>
</div>
<div class="controls">
<div class="controls-row">
<div><label>Texte Taille</label><div class="slider-container"><div id="text-slider" class="slider-bille"></div></div></div>
<div><label>Texte Largeur</label><div class="slider-container"><div id="text-width-slider" class="slider-bille"></div></div></div>
<div><label>Image Taille</label><div class="slider-container"><div id="image-slider" class="slider-bille"></div></div></div>
</div>
</div>
</div>
<div style="margin-top:10px; text-align:center;">
<button onclick="prevPreview()">‚¨ÖÔ∏è Pr√©c√©dent</button>
<button onclick="nextPreview()">‚û°Ô∏è Suivant</button>
<button onclick="savePreview()">üíæ Enregistrer</button>
<button onclick="goEditor()">üè† Retour √† l'√©diteur</button>
</div>
</div>

<!-- Jeu -->
<div id="game-screen" class="hidden">
<h2 id="game-title"></h2>
<div class="card-container">
<div class="card" onclick="flipCard()">
<div class="card-face card-front">
<img id="card-image-front"/>
<div id="card-question"></div>
</div>
<div class="card-face card-back">
<img id="card-image-back"/>
<div id="card-answer"></div>
</div>
</div>
</div>
<div class="answer-buttons">
<button class="incorrect" onclick="markAnswer(false)">Mauvais</button>
<button class="correct" onclick="markAnswer(true)">Bon</button>
</div>
</div>

<!-- Score -->
<div id="score-screen" class="hidden">
<h2>R√©sultat</h2>
<p id="final-score"></p>
<button onclick="restartAll()">üîÑ Recommencer tout</button>
<button onclick="restartErrors()">‚ùå Rejouer erreurs</button>
<button onclick="goHome()">üè† Accueil</button>
</div>

</div>

<script>
// ===== Variables =====
let sets = JSON.parse(localStorage.getItem("sets")) || [];
let currentSet=null, currentCards=[], currentIndex=0, errors=[];
let previewIndex=0, previewSide='question';

// ===== Sauvegarde =====
function saveSets(){ localStorage.setItem("sets",JSON.stringify(sets)); }
function goHome(){ document.querySelectorAll(".container>div").forEach(d=>d.classList.add("hidden")); document.getElementById("home-screen").classList.remove("hidden"); displaySets(); }

// ===== √âditeur =====
function showSetEditor(setIndex=null){
document.querySelectorAll(".container>div").forEach(d=>d.classList.add("hidden"));
document.getElementById("editor-screen").classList.remove("hidden");
document.getElementById("cards-editor").innerHTML="";
document.getElementById("set-image-file").onchange=(e)=>{const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=(ev)=>{document.getElementById("set-image").value=ev.target.result}; r.readAsDataURL(f)};
if(setIndex!==null){ currentSet=sets[setIndex]; document.getElementById("set-title").value=currentSet.title; document.getElementById("set-subject").value=currentSet.subject; document.getElementById("set-image").value=currentSet.image; currentSet.cards.forEach(c=>addCardEditor(c.question.text,c.answer.text,c.image.src));} else currentSet=null;
}

function addCardEditor(q='',a='',img=''){
const div=document.createElement("div"); div.className="card-editor";
div.innerHTML=`<input placeholder="Question" value="${q}"><input placeholder="R√©ponse" value="${a}"><input placeholder="URL image" value="${img}"><input type="file" accept="image/*" class="img-upload" style="display:none"><button class="btn-photo">üì∏ Galerie</button><button class="btn-del-card">üóëÔ∏è Supprimer</button><hr>`;
document.getElementById("cards-editor").appendChild(div);
const imgInput=div.querySelector(".img-upload"); const urlInput=div.children[2];
div.querySelector(".btn-photo").onclick=()=>imgInput.click();
imgInput.onchange=(e)=>{const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=(ev)=>{urlInput.value=ev.target.result}; r.readAsDataURL(f)};
div.querySelector(".btn-del-card").onclick=()=>div.remove();
}

function saveSet(){
const title=document.getElementById("set-title").value;
const subject=document.getElementById("set-subject").value;
const image=document.getElementById("set-image").value;
const cards=[];
document.querySelectorAll("#cards-editor>.card-editor").forEach(div=>{
  const q=div.children[0].value; const a=div.children[1].value; const img=div.children[2].value;
  if(q && a) cards.push({question:{text:q,top:50,left:50,fontSize:36,width:200},answer:{text:a,top:50,left:50,fontSize:36,width:200},image:{src:img,top:100,left:50,height:250}});
});
if(currentSet){ currentSet.title=title; currentSet.subject=subject; currentSet.image=image; currentSet.cards=cards; } else sets.push({title,subject,image,cards});
saveSets(); currentSet=null; goHome();
}

// ===== Jeu =====
function startGame(i){
currentSet=sets[i]; currentCards=[...currentSet.cards]; for(let j=currentCards.length-1;j>0;j--){ const k=Math.floor(Math.random()*(j+1)); [currentCards[j],currentCards[k]]=[currentCards[k],currentCards[j]];}
currentIndex=0; errors=[]; document.querySelectorAll(".container>div").forEach(d=>d.classList.add("hidden")); document.getElementById("game-screen").classList.remove("hidden"); document.getElementById("game-title").textContent=currentSet.title; showCard();
}

function showCard(){
const card=currentCards[currentIndex]; const frontImg=document.getElementById("card-image-front"); const backImg=document.getElementById("card-image-back");
const frontDiv=document.getElementById("card-question"); const backDiv=document.getElementById("card-answer");

frontDiv.textContent=card.question.text; frontDiv.style.top=card.question.top+'px'; frontDiv.style.left=card.question.left+'px'; frontDiv.style.fontSize=card.question.fontSize+'px'; frontDiv.style.width=card.question.width+'px';
backDiv.textContent=card.answer.text; backDiv.style.top=card.answer.top+'px'; backDiv.style.left=card.answer.left+'px'; backDiv.style.fontSize=card.answer.fontSize+'px'; backDiv.style.width=card.answer.width+'px';

if(card.image.src){ frontImg.src=card.image.src; frontImg.style.display='block'; frontImg.style.top=card.image.top+'px'; frontImg.style.left=card.image.left+'px'; frontImg.style.height=card.image.height+'px';
backImg.src=card.image.src; backImg.style.display='block'; backImg.style.top=card.image.top+'px'; backImg.style.left=card.image.left+'px'; backImg.style.height=card.image.height+'px'; } else { frontImg.style.display='none'; backImg.style.display='none'; }
document.querySelector(".card").classList.remove("flipped");
}

function flipCard(){ document.querySelector(".card").classList.toggle("flipped"); }
function markAnswer(correct){ if(!correct) errors.push(currentCards[currentIndex]); currentIndex++; if(currentIndex<currentCards.length) showCard(); else endGame(); }
function endGame(){ document.querySelectorAll(".container>div").forEach(div=>div.classList.add("hidden")); document.getElementById("score-screen").classList.remove("hidden"); document.getElementById("final-score").textContent=`Score: ${currentCards.length-errors.length}/${currentCards.length}`; }
function restartAll(){ currentCards=[...currentSet.cards]; currentIndex=0; errors=[]; document.querySelectorAll(".container>div").forEach(div=>div.classList.remove("hidden")); document.getElementById("game-screen").classList.remove("hidden"); showCard(); }
function restartErrors(){ if(errors.length===0){ alert("Aucune erreur !"); return; } currentCards=[...errors]; currentIndex=0; errors=[]; document.querySelectorAll(".container>div").forEach(div=>div.classList.remove("hidden")); document.getElementById("game-screen").classList.remove("hidden"); showCard(); }

// ===== Pr√©visualisation =====
function showPreviewForCurrentSet(){ showPreview(currentSet ? sets.indexOf(currentSet) : 0); }
function showPreview(setIndex){ document.querySelectorAll(".container>div").forEach(d=>d.classList.add("hidden")); document.getElementById("preview-screen").classList.remove("hidden"); previewIndex=0; previewSide='question'; currentSet=sets[setIndex]; showPreviewCard(); }
function showPreviewCard(){ 
const card=currentSet.cards[previewIndex]; 
const elText=document.getElementById("preview-text"); 
const elImg=document.getElementById("preview-image"); 
let side=previewSide==='question'?card.question:card.answer; 
elText.textContent=side.text; elText.style.top=side.top+'px'; elText.style.left=side.left+'px'; elText.style.fontSize=side.fontSize+'px'; elText.style.width=side.width+'px';
elImg.src=card.image.src; elImg.style.top=card.image.top+'px'; elImg.style.left=card.image.left+'px'; elImg.style.height=card.image.height+'px'; 
document.getElementById("text-slider").style.bottom=side.fontSize+'px'; 
document.getElementById("text-width-slider").style.bottom=side.width+'px';
document.getElementById("image-slider").style.bottom=card.image.height+'px';
}
function nextPreview(){ if(previewSide==='question') previewSide='answer'; else { previewSide='question'; previewIndex=Math.min(previewIndex+1,currentSet.cards.length-1);} showPreviewCard();}
function prevPreview(){ if(previewSide==='answer') previewSide='question'; else { previewIndex=Math.max(previewIndex-1,0); previewSide='answer'; } showPreviewCard();}
function savePreview(){ saveSets(); alert("Modifications enregistr√©es !"); }
function goEditor(){ document.getElementById("preview-screen").classList.add("hidden"); document.getElementById("editor-screen").classList.remove("hidden"); }

// ===== Drag & Sliders =====
function makeDraggable(el,propTop,propLeft){ let isDragging=false,startX,startY,startTop,startLeft; const move=(dx,dy)=>{ el.style.top=startTop+dy+'px'; el.style.left=startLeft+dx+'px'; let side=previewSide==='question'?currentSet.cards[previewIndex].question:currentSet.cards[previewIndex].answer; side[propTop]=startTop+dy; side[propLeft]=startLeft+dx; };
el.addEventListener('mousedown',e=>{ isDragging=true; startX=e.clientX; startY=e.clientY; startTop=parseInt(el.style.top); startLeft=parseInt(el.style.left); el.style.cursor='grabbing';});
document.addEventListener('mousemove',e=>{ if(!isDragging) return; move(e.clientX-startX,e.clientY-startY); });
document.addEventListener('mouseup',e=>{isDragging=false; el.style.cursor='grab';});
el.addEventListener('touchstart',e=>{isDragging=true; startX=e.touches[0].clientX; startY=e.touches[0].clientY; startTop=parseInt(el.style.top); startLeft=parseInt(el.style.left); });
el.addEventListener('touchmove',e=>{ if(!isDragging)return; e.preventDefault(); move(e.touches[0].clientX-startX,e.touches[0].clientY-startY); });
el.addEventListener('touchend',e=>{isDragging=false;});
}

function initSlider(sliderId,prop,el,isWidth=false){
const slider=document.getElementById(sliderId); let isDragging=false,startY,startVal,card,side;
slider.addEventListener('mousedown',e=>{isDragging=true; startY=e.clientY; card=currentSet.cards[previewIndex]; side=previewSide==='question'?card.question:card.answer; startVal=isWidth?side.width:side.fontSize;});
document.addEventListener('mousemove',e=>{ if(!isDragging) return; let dy=startY-e.clientY; let newVal=Math.min(500,Math.max(12,startVal+dy)); if(isWidth) side.width=newVal; else side.fontSize=newVal; el.style[isWidth?'width':'fontSize']=newVal+'px'; slider.style.bottom=newVal+'px'; });
document.addEventListener('mouseup',e=>{isDragging=false;});
slider.addEventListener('touchstart',e=>{isDragging=true; startY=e.touches[0].clientY; card=currentSet.cards[previewIndex]; side=previewSide==='question'?card.question:card.answer; startVal=isWidth?side.width:side.fontSize;});
slider.addEventListener('touchmove',e=>{if(!isDragging) return; e.preventDefault(); let dy=startY-e.touches[0].clientY; let newVal=Math.min(500,Math.max(12,startVal+dy)); if(isWidth) side.width=newVal; else side.fontSize=newVal; el.style[isWidth?'width':'fontSize']=newVal+'px'; slider.style.bottom=newVal+'px';});
slider.addEventListener('touchend',e=>{isDragging=false;});
}

makeDraggable(document.getElementById("preview-text"),'top','left');
makeDraggable(document.getElementById("preview-image"),'top','left');
initSlider("text-slider","fontSize",document.getElementById("preview-text"));
initSlider("text-width-slider","width",document.getElementById("preview-text"),true);
initSlider("image-slider","height",document.getElementById("preview-image"));

// ===== Display sets =====
function displaySets(){ const list=document.getElementById("sets-list"); list.innerHTML=""; sets.forEach((s,i)=>{ const div=document.createElement("div"); div.className="set"; div.innerHTML=`<img src="${s.image||'https://via.placeholder.com/60'}"><div><strong>${s.title}</strong><br><small>${s.subject}</small></div>`; div.onclick=()=>startGame(i); const btnDiv=document.createElement("div"); btnDiv.className="set-buttons";
let editBtn=document.createElement("button"); editBtn.textContent="‚úèÔ∏è Modifier"; editBtn.onclick=e=>{ e.stopPropagation(); showSetEditor(i); };
let delBtn=document.createElement("button"); delBtn.textContent="üóëÔ∏è Supprimer"; delBtn.onclick=e=>{ e.stopPropagation(); if(confirm("Supprimer ?")){ sets.splice(i,1); saveSets(); displaySets(); }};
let shareBtn=document.createElement("button"); shareBtn.textContent="üì§ Partager"; shareBtn.onclick=async e=>{ e.stopPropagation(); const jsonStr=JSON.stringify(sets[i],null,2); const blob=new Blob([jsonStr],{type:"application/json"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download=`${sets[i].title.replace(/[^a-z0-9]/gi,"_")||"set"}.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); alert("Fichier t√©l√©charg√© !"); };
btnDiv.appendChild(editBtn); btnDiv.appendChild(delBtn); btnDiv.appendChild(shareBtn); div.appendChild(btnDiv); list.appendChild(div); });
}

// ===== Import =====
function importSet(event){ const file=event.target.files[0]; if(!file)return; const reader=new FileReader(); reader.onload=function(e){ try{ const importedSet=JSON.parse(e.target.result); sets.push(importedSet); saveSets(); displaySets(); alert("Set import√© !"); }catch(err){ alert("Fichier invalide !");} }; reader.readAsText(file); }

goHome();
</script>
</body>
</html>
