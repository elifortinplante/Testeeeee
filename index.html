<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mes Flashcards</title>
  <style>
    body { margin:0; font-family: Arial; background: linear-gradient(135deg, #a18cd1, #fbc2eb, #8fd3f4); display:flex; justify-content:center; align-items:flex-start; padding:20px;}
    .container { width:100%; max-width:800px; background:white; border-radius:20px; padding:20px; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
    h1,h2{text-align:center; color:#333;}
    button{padding:10px; margin:5px; border:none; border-radius:10px; cursor:pointer;}
    .set{display:flex; align-items:center; justify-content:space-between; padding:10px; margin:5px 0; background:#eee; border-radius:10px; cursor:pointer;}
    .card-container { perspective:1000px; margin:20px 0;}
    .card { width:100%; height:300px; position:relative; transform-style: preserve-3d; transition: transform 0.6s; cursor:pointer; }
    .card.flipped { transform: rotateY(180deg); }
    .card-face { position:absolute; width:100%; height:100%; backface-visibility:hidden; border-radius:20px; display:flex; justify-content:center; align-items:center; font-weight:bold; text-align:center; padding:20px; box-sizing:border-box; color:#333; background:#fff; }
    .card-back { transform: rotateY(180deg); background:#f0f0f0; }
  </style>
</head>
<body>
<div class="container">

  <!-- Accueil -->
  <div id="home-screen">
    <h1>Mes Sets</h1>
    <button onclick="showSetEditor()">‚ûï Nouveau set</button>
    <div id="sets-list"></div>
  </div>

  <!-- √âditeur de set -->
  <div id="editor-screen" class="hidden">
    <h2>Cr√©er / Modifier un Set</h2>
    <input type="text" id="set-title" placeholder="Titre du set"><br><br>
    <div id="cards-editor"></div>
    <button onclick="addCardEditor()">‚ûï Ajouter une carte</button><br><br>
    <button onclick="saveSet()">üíæ Sauvegarder</button>
    <button onclick="goHome()">üè† Accueil</button>
  </div>

  <!-- Jeu -->
  <div id="game-screen" class="hidden">
    <h2 id="game-title"></h2>
    <div class="card-container">
      <div class="card" onclick="flipCard()">
        <div class="card-face card-front"><div id="card-question"></div></div>
        <div class="card-face card-back"><div id="card-answer"></div></div>
      </div>
    </div>
    <div>
      <button onclick="markAnswer(false)">Mauvais</button>
      <button onclick="markAnswer(true)">Bon</button>
    </div>
  </div>

  <!-- Score -->
  <div id="score-screen" class="hidden">
    <h2>R√©sultat</h2>
    <p id="final-score"></p>
    <button onclick="restartAll()">üîÑ Recommencer tout</button>
    <button onclick="restartErrors()">‚ùå Rejouer erreurs</button>
    <button onclick="goHome()">üè† Accueil</button>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

// Configuration Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBj2oSXyXuiXsxbIVYRZLSqE0OczPjgk6I",
  authDomain: "mesflashcards.firebaseapp.com",
  projectId: "mesflashcards",
  storageBucket: "mesflashcards.firebasestorage.app",
  messagingSenderId: "307428456397",
  appId: "1:307428456397:web:122607a9c47b02f5633684"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Variables globales
let currentSet = null;
let currentCards = [];
let currentIndex = 0;
let errors = [];

// Navigation
function goHome() {
  document.getElementById("home-screen").classList.remove("hidden");
  document.getElementById("editor-screen").classList.add("hidden");
  document.getElementById("game-screen").classList.add("hidden");
  document.getElementById("score-screen").classList.add("hidden");
  displaySets();
}

// √âditeur
function showSetEditor(set=null){
  currentSet = set;
  document.getElementById("home-screen").classList.add("hidden");
  document.getElementById("editor-screen").classList.remove("hidden");
  document.getElementById("set-title").value = set ? set.title : "";
  const editor = document.getElementById("cards-editor");
  editor.innerHTML = "";
  if(set && set.cards) set.cards.forEach(c=>addCardEditor(c.question,c.answer));
}

function addCardEditor(q="",a=""){
  const div = document.createElement("div");
  div.innerHTML = `
    <input type="text" placeholder="Question" value="${q}">
    <input type="text" placeholder="R√©ponse" value="${a}">
    <button class="btn-del">üóëÔ∏è Supprimer</button>
    <hr>`;
  document.getElementById("cards-editor").appendChild(div);
  div.querySelector(".btn-del").onclick = ()=> div.remove();
}

async function saveSet(){
  const title = document.getElementById("set-title").value;
  const cards = [];
  document.querySelectorAll("#cards-editor > div").forEach(d=>{
    const q = d.children[0].value;
    const a = d.children[1].value;
    if(q && a) cards.push({question:q, answer:a});
  });
  if(!title || cards.length===0){ alert("Titre et cartes obligatoires !"); return; }
  const setData = { title, cards };
  await addDoc(collection(db,"sets"), setData);
  alert("Set sauvegard√© !");
  goHome();
}

// Affichage sets
async function displaySets(){
  const list = document.getElementById("sets-list");
  list.innerHTML = "";
  const querySnapshot = await getDocs(collection(db,"sets"));
  querySnapshot.forEach(doc=>{
    const s = doc.data();
    const div = document.createElement("div");
    div.className = "set";
    div.textContent = s.title;
    div.onclick = ()=> startGame(s);
    list.appendChild(div);
  });
}

// Jeu
function startGame(set){
  currentSet = set;
  currentCards = [...set.cards];
  currentIndex = 0;
  errors = [];
  document.getElementById("home-screen").classList.add("hidden");
  document.getElementById("editor-screen").classList.add("hidden");
  document.getElementById("score-screen").classList.add("hidden");
  document.getElementById("game-screen").classList.remove("hidden");
  document.getElementById("game-title").textContent = set.title;
  showCard();
}

function showCard(){
  const card = currentCards[currentIndex];
  document.getElementById("card-question").textContent = card.question;
  document.getElementById("card-answer").textContent = card.answer;
  document.querySelector(".card").classList.remove("flipped");
}

function flipCard(){ document.querySelector(".card").classList.toggle("flipped"); }
function markAnswer(correct){ if(!correct) errors.push(currentCards[currentIndex]); currentIndex++;
  if(currentIndex < currentCards.length) showCard(); else endGame();
}

function endGame(){
  document.getElementById("game-screen").classList.add("hidden");
  document.getElementById("score-screen").classList.remove("hidden");
  document.getElementById("final-score").textContent = `Score: ${currentCards.length-errors.length}/${currentCards.length}`;
}

function restartAll(){ currentCards=[...currentSet.cards]; currentIndex=0; errors=[]; document.getElementById("game-screen").classList.remove("hidden"); document.getElementById("score-screen").classList.add("hidden"); showCard();}
function restartErrors(){ if(errors.length===0){ alert("Aucune erreur !"); return; } currentCards=[...errors]; currentIndex=0; errors=[]; document.getElementById("game-screen").classList.remove("hidden"); document.getElementById("score-screen").classList.add("hidden"); showCard();}

// Initialisation
goHome();

</script>
</body>
</html>
